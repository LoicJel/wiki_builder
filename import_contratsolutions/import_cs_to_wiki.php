<?php

$GLOBALS['links'] = json_decode('[{"target_name":"Ravageurs","production_name":"Cultures assol\u00e9es","background_color":"#13696d","number":"37","title":"<p>Allongement de la rotation et diversification de l\u2019assolement pour construire un syst\u00e8me plus robuste face aux bioagresseurs telluriques<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/allongement-de-la-rotation-et-diversification-de-lassolement-pour-construire-un-systeme-plus-robuste-face-aux-bioagresseurs-telluriques\/"},{"target_name":"Adventices","production_name":"Toutes cultures","background_color":"#13696d","number":"19","title":"<p>D\u00e9veloppement\u00a0du d\u00e9sherbage m\u00e9canique<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/developpement-du-desherbage-mecanique\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"64","title":"<p><strong>Outils de sensibilisation sur les risques de pollutions ponctuelles par les produits phytopharmaceutiques<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outils-de-sensibilisation-sur-les-risques-de-pollutions-ponctuelles-par-les-produits-phytopharmaceutiques\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"32","title":"<p>Am\u00e9liorer les formulations\u00a0en r\u00e9duisant\u00a0les poudres mouillables (WP)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/ameliorer-les-formulations-en-reduisant-les-poudres-mouillables-wp\/"},{"target_name":"Autre","production_name":"Pommier","background_color":"#59c6c8","number":"68","title":"<p><strong>Eclaircissage de pommiers en biocontr\u00f4le <\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/eclaircissage-de-pommiers-en-biocontrole\/"},{"target_name":"Ravageurs","production_name":"Grandes Cultures","background_color":"#54ccdc","number":"27","title":"<p>Lutte contre les limaces avec l\u2019utilisation du phosphate ferrique<\/p>\n<p>&nbsp;<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-les-limaces-avec-lutilisation-du-phosphate-ferrique\/"},{"target_name":"Ravageurs","production_name":"Toutes cultures","background_color":"#13696d","number":"4","title":"<p class=\"p1\">Bandes fleuries pour optimiser le service de r\u00e9gulation naturelle des bio-agresseurs apport\u00e9 par la faune auxiliaire<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/bandes-fleuries-pour-optimiser-le-service-de-regulation-naturelle-des-bio-agresseurs-apporte-par-la-faune-auxiliaire\/"},{"target_name":"Autre","production_name":"Pomme de Terre","background_color":"#54ccdc","number":"60","title":"<p><strong>Alternatives limitant le recours au d\u00e9fanage chimique de la pomme de terre<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/alternatives-limitant-le-recours-au-defanage-chimique-de-la-pomme-de-terre\/"},{"target_name":"Ravageurs","production_name":"Cultures ornementales","background_color":"#27b8c0","number":"38","title":"<p>Plantes pi\u00e8ges en productions ornementales<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/plantes-pieges-en-productions-ornementales\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"57","title":"<p>Formation au biocontr\u00f4le<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/formation-au-biocontrole\/"},{"target_name":"Adventices Ravageurs","production_name":"Colza","background_color":"#54ccdc","number":"2","title":"<p>Associer au semis un colza avec des l\u00e9gumineuses g\u00e9lives<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/associer-au-semis-un-colza-avec-des-legumineuses-gelives\/"},{"target_name":"Ravageurs","production_name":"Brassicac\u00e9es l\u00e9gumi\u00e8res","background_color":"#098aa9","number":"39","title":"<p>Solution \u00e9mergente : Application de la strat\u00e9gie push-pull en production de brassicac\u00e9es l\u00e9gumi\u00e8res<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/solution-emergente-application-de-la-strategie-push-pull-en-production-de-brassicacees-legumieres\/"},{"target_name":"Maladies","production_name":"Vigne, cultures l\u00e9gumi\u00e8res","background_color":"#13696d","number":"54","title":"<p>Utilisation d\u2019un stimulateur des d\u00e9fenses naturelles\u00a0pour lutter contre le mildiou et l\u2019o\u00efdium de la vigne\u00a0et contre l\u2019o\u00efdium des cucurbitac\u00e9es,\u00a0le mildiou des laitues\u00a0et la pourriture grise de la tomate et du fraisier<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-dun-stimulateur-des-defenses-naturelles-pour-lutter-contre-le-mildiou-et-loidium-de-la-vigne-et-contre-loidium-des-cucurbitacees-le-mildiou-des-laitues-et-la-po\/"},{"target_name":"Maladies","production_name":"Toutes cultures","background_color":"#13696d","number":"69","title":"<p><strong>Lutte collective contre le feu bact\u00e9rien<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-collective-contre-le-feu-bacterien\/"},{"target_name":"Autre","production_name":"Bl\u00e9 tendre","background_color":"#54ccdc","number":"7","title":"<p class=\"p1\">Lutte contre la verse physiologique par la r\u00e9sistance des vari\u00e9t\u00e9s de bl\u00e9 tendre<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-la-verse-physiologique-par-la-resistance-des-varietes-de-ble-tendre\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"36","title":"<p>Charte de bon voisinage<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/227\/"},{"target_name":"Adventices","production_name":"Val\u00e9riane","background_color":"#27b8c0","number":"44","title":"<p>Cr\u00e9ation d\u2019une vari\u00e9t\u00e9\u00a0de val\u00e9riane permettant\u00a0un meilleur contr\u00f4le des adventices<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/creation-dune-variete-de-valeriane-permettant-un-meilleur-controle-des-adventices\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"18","title":"<p>Equipements de Protection Individuelle (EPI) :\u00a0syst\u00e9matiser leur utilisation dans le cadre\u00a0de la pr\u00e9vention du risque chimique<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/equipements-de-protection-individuelle-epi-systematiser-leur-utilisation-dans-le-cadre-de-la-prevention-du-risque-chimique\/"},{"target_name":"Maladies Ravageurs","production_name":"Tomate Aubergine Melon Concombre","background_color":"#13696d","number":"13","title":"<p>Utiliser des porte-greffes solanac\u00e9es et cucurbitac\u00e9es pour limiter les maladies et ravageurs telluriques<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utiliser-des-porte-greffes-solanacees-et-cucurbitacees-pour-limiter-les-maladies-et-ravageurs-telluriques\/"},{"target_name":"Autre","production_name":"Pomme de Terre","background_color":"#54ccdc","number":"56","title":"<p>Stockage : action de pr\u00e9servation des r\u00e9coltes de pommes de terre<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/stockage-action-de-preservation-des-recoltes-de-pommes-de-terre\/"},{"target_name":"Ravageurs","production_name":"Tomate","background_color":"#098aa9","number":"51","title":"<p>Confusion sexuelle\u00a0contre la mineuse de la tomate\u00a0(Tuta absoluta)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/confusion-sexuelle-contre-la-mineuse-de-la-tomate-tuta-absoluta\/"},{"target_name":"Maladies","production_name":"Chou fleur","background_color":"#098aa9","number":"61","title":"<p><strong>Utiliser des vari\u00e9t\u00e9s de chou-fleur tol\u00e9rantes \u00e0 la maladie des t\u00e2ches noires <\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utiliser-des-varietes-de-chou-fleur-tolerantes-a-la-maladie-des-taches-noires\/"},{"target_name":"Adventices","production_name":"Arboriculture","background_color":"#59c6c8","number":"21","title":"<p>G\u00e9rer le d\u00e9veloppement des adventices sans glyphosate en arboriculture<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/gerer-le-developpement-des-adventices-sans-glyphosate-en-arboriculture\/"},{"target_name":"Ravageurs","production_name":"C\u00e9r\u00e9ales","background_color":"#54ccdc","number":"34","title":"<p>Stockage : action de pr\u00e9servation des r\u00e9coltes<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/stockage-action-de-preservation-des-recoltes\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"65","title":"<p><strong>Outils de diagnostic des risques de pollutions ponctuelles par les produits phytopharmaceutiques<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outils-de-diagnostic-des-risques-de-pollutions-ponctuelles-par-les-produits-phytopharmaceutiques\/"},{"target_name":"Maladies","production_name":"Cultures l\u00e9gumi\u00e8res","background_color":"#098aa9","number":"53","title":"<p>Lutte contre les maladies telluriques\u00a0(Pythium sp. et Rhizoctonia)\u00a0en cultures l\u00e9gumi\u00e8res\u00a0avec Trichoderma atroviride I-1237<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-les-maladies-telluriques-pythium-sp-et-rhizoctonia-en-cultures-legumieres-avec-trichoderma-atroviride-i-1237\/"},{"target_name":"Adventices Ravageurs","production_name":"Bl\u00e9 tendre","background_color":"#54ccdc","number":"1","title":"<p>D\u00e9calage de la date de semis en bl\u00e9 tendre d\u2019hiver<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/decalage-de-la-date-de-semis-en-ble-tendre-dhiver-2\/"},{"target_name":"Ravageurs","production_name":"Lavande","background_color":"#27b8c0","number":"24","title":"<p>Pulv\u00e9risation d\u2019argile sur lavandes\/lavandins<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/pulverisation-dargile-sur-lavandes-lavandins\/"},{"target_name":"Maladies","production_name":"Bl\u00e9","background_color":"#54ccdc","number":"46","title":"<p>Outils d\u2019aide \u00e0 la d\u00e9cision\u00a0pour optimiser les traitements\u00a0contre les maladies du bl\u00e9<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outils-daide-a-la-decision-pour-optimiser-les-traitements-contre-les-maladies-du-ble\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"16","title":"<p>Classification des technologies\u00a0de pulv\u00e9risation<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/classification-des-technologies-de-pulverisation\/"},{"target_name":"Maladies","production_name":"Tournesol","background_color":"#54ccdc","number":"10","title":"<p>Ma\u00eetrise du mildiou du tournesol par la g\u00e9n\u00e9tique<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/maitrise-du-mildiou-du-tournesol-par-la-genetique\/"},{"target_name":"Ravageurs","production_name":"Colza","background_color":"#54ccdc","number":"41","title":"<p>Utilisation de vari\u00e9t\u00e9s\u00a0de colza d\u2019hiver\u00a0r\u00e9sistantes TUYV<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-de-varietes-de-colza-dhiver-resistantes-tuyv\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"55","title":"<p>Am\u00e9liorer les \u00e9tiquettes\u00a0des produits phytopharmaceutiques<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/ameliorer-les-etiquettes-des-produits-phytopharmaceutiques\/"},{"target_name":"Ravageurs","production_name":"Arboriculture","background_color":"#59c6c8","number":"3","title":"<p>Filets insect proof en arboriculture (Syst\u00e8me mono rang)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/filets-insect-proof-en-arboriculture-systeme-mono-rang\/"},{"target_name":"Maladies","production_name":"Lavande","background_color":"#27b8c0","number":"43","title":"<p>Cr\u00e9ation de vari\u00e9t\u00e9s\u00a0de lavande tol\u00e9rante\u00a0au d\u00e9p\u00e9rissement de la lavande<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/creation-de-varietes-de-lavande-tolerante-au-deperissement-de-la-lavande\/"},{"target_name":"Maladies","production_name":"Colza et Cultures l\u00e9gumi\u00e8res","background_color":"#098aa9","number":"30","title":"<p>Lutte contre le scl\u00e9rotinia avec Coniothyrium minitans<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-le-sclerotinia-avec-coniothyrium-minitans\/"},{"target_name":"Adventices","production_name":"Tournesol","background_color":"#54ccdc","number":"11","title":"<p>Ma\u00eetrise de l\u2019orobanche cumana du tournesol<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/maitrise-de-lorobanche-cumana-du-tournesol\/"},{"target_name":"Ravageurs","production_name":"Colza","background_color":"#54ccdc","number":"40","title":"<p>Eviter un traitement insecticide\u00a0contre les m\u00e9lig\u00e8thes en associant\u00a0une vari\u00e9t\u00e9 de colza \u00e0 floraison\u00a0tr\u00e8s pr\u00e9coce avec la vari\u00e9t\u00e9 d\u2019int\u00e9r\u00eat<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/eviter-un-traitement-insecticide-contre-les-meligethes-en-associant-une-variete-de-colza-a-floraison-tres-precoce-avec-la-variete-dinteret\/"},{"target_name":"Ravageurs","production_name":"Cultures l\u00e9gumi\u00e8res","background_color":"#098aa9","number":"59","title":"<p><strong>Utiliser des filets anti-insectes sur cultures l\u00e9gumi\u00e8res<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utiliser-des-filets-anti-insectes-sur-cultures-legumieres\/"},{"target_name":"Adventices","production_name":"Toutes cultures","background_color":"#13696d","number":"58","title":"<p>Pratique des paillages et mulchs<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/pratique-des-paillages-et-mulchs\/"},{"target_name":"Maladies","production_name":"Pomme de Terre","background_color":"#54ccdc","number":"14","title":"<p>Outil d\u2019aide \u00e0 la d\u00e9cision\u00a0pour optimiser les traitements anti-mildiou\u00a0sur pomme de terre<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outil-daide-a-la-decision-pour-optimiser-les-traitements-anti-mildiou-sur-pomme-de-terre\/"},{"target_name":"Ravageurs","production_name":"Vigne","background_color":"#129a8a","number":"50","title":"<p>Confusion sexuelle vigne<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/confusion-sexuelle-vigne\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"33","title":"<p>ESTA \u2013 PQP &#8211; Un engagement des entreprises semenci\u00e8res pour prot\u00e9ger l\u2019environnement, les pollinisateurs et les op\u00e9rateurs<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/esta-pqp-un-engagement-des-entreprises-semencieres-pour-proteger-lenvironnement-les-pollinisateurs-et-les-operateurs\/"},{"target_name":"Maladies","production_name":"Bl\u00e9 tendre","background_color":"#54ccdc","number":"6","title":"<p class=\"p1\">Lutte contre les maladies du bl\u00e9 tendre par la r\u00e9sistance des vari\u00e9t\u00e9s<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-les-maladies-du-ble-tendre-par-la-resistance-des-varietes\/"},{"target_name":"Adventices","production_name":"Prairies temporaires et permanentes","background_color":"#13696d","number":"48","title":"<p>Outil d\u2019aide \u00e0 la d\u00e9cision\u00a0pour optimiser la gestion des adventices\u00a0et des esp\u00e8ces ind\u00e9sirables\u00a0en prairies temporaires et permanentes<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outil-daide-a-la-decision-pour-optimiser-la-gestion-des-adventices-et-des-especes-indesirables-en-prairies-temporaires-et-permanentes\/"},{"target_name":"Adventices","production_name":"Vigne","background_color":"#129a8a","number":"20","title":"<p>G\u00e9rer le d\u00e9veloppement des adventices sans glyphosate en viticulture sur le rang<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/gerer-le-developpement-des-adventices-sans-glyphosate-en-viticulture-sur-le-rang\/"},{"target_name":"Maladies","production_name":"Pommier","background_color":"#59c6c8","number":"12","title":"<p>Utilisation de vari\u00e9t\u00e9s r\u00e9sistantes \u00e0 la tavelure en production de pomme<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-de-varietes-resistantes-a-la-tavelure-en-production-de-pomme\/"},{"target_name":"Maladies","production_name":"Basilic","background_color":"#27b8c0","number":"9","title":"<p>Cr\u00e9ation d\u2019une vari\u00e9t\u00e9 de basilic de type \u00ab Grand Vert \u00bb tol\u00e9rante au mildiou du basilic<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/creation-dune-variete-de-basilic-de-type-grand-vert-tolerante-au-mildiou-du-basilic\/"},{"target_name":"Maladies","production_name":"Vigne","background_color":"#129a8a","number":"15","title":"<p>Outil d\u2019aide \u00e0 la d\u00e9cision\u00a0pour optimiser les traitements\u00a0contre le mildiou et l\u2019o\u00efdium sur vigne<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/outil-daide-a-la-decision-pour-optimiser-les-traitements-contre-le-mildiou-et-loidium-sur-vigne\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"45","title":"<p>Modernisation\u00a0des Pulv\u00e9risateurs\u00a0en Service (MPS)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/modernisation-des-pulverisateurs-en-service-mps\/"},{"target_name":"Maladies","production_name":"Tomate","background_color":"#098aa9","number":"42","title":"<p>Utiliser des vari\u00e9t\u00e9s de tomate\u00a0tol\u00e9rantes \u00e0 l\u2019o\u00efdium<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utiliser-des-varietes-de-tomate-tolerantes-a-loidium\/"},{"target_name":"Maladies","production_name":"Haricot","background_color":"#098aa9","number":"47","title":"<p>Outil d&rsquo;aide \u00e0 la d\u00e9cision de gestion\u00a0du scl\u00e9rotinia sur haricots<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/oad-de-gestion-du-sclerotinia-sur-haricots\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"35","title":"<p>Am\u00e9lioration de la gestion des d\u00e9chets pour l\u2019ensemble des moyens de protection des plantes<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/amelioration-de-la-gestion-des-dechets-pour-lensemble-des-moyens-de-protection-des-plantes\/"},{"target_name":"Ravageurs","production_name":"Toutes cultures","background_color":"#13696d","number":"67","title":"<p>Combinaison de m\u00e9thodes alternatives, dont les produits de biocontr\u00f4le, pour la gestion des n\u00e9matodes \u00e0 galles<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/combinaison-de-methodes-alternatives-dont-les-produits-de-biocontrole-pour-la-gestion-des-nematodes-a-galles\/"},{"target_name":"Adventices","production_name":"Grandes Cultures","background_color":"#54ccdc","number":"22","title":"<p>M\u00e9thodes alternatives visant une r\u00e9duction d\u2019usage du glyphosate en grandes cultures<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/methodes-alternatives-visant-une-reduction-dusage-du-glyphosate-en-grandes-cultures\/"},{"target_name":"Ravageurs","production_name":"Vigne","background_color":"#129a8a","number":"26","title":"<p>Lutte pr\u00e9ventive contre les tordeuses de la vigne \u00e0 l\u2019aide de trichogrammes<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-preventive-contre-les-tordeuses-de-la-vigne-a-laide-de-trichogrammes\/"},{"target_name":"Maladies","production_name":"Cultures l\u00e9gumi\u00e8res et fruiti\u00e8res, champignon de couche","background_color":"#13696d","number":"52","title":"<p>Lutte contre les maladies fongiques et bact\u00e9riennes\u00a0des cultures l\u00e9gumi\u00e8res et fruiti\u00e8res avec <em>Bacillus amyloliquefaciens\u00a0subsp. plantarum<\/em> souche D747<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-les-maladies-fongiques-et-bacteriennes-des-cultures-legumieres-et-fruitieres-avec-bacillus-amyloliquefaciens-subsp-plantarum-souche-d747\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"17","title":"<p>D\u00e9veloppement de formations au r\u00e9glage\u00a0et \u00e0 la bonne utilisation des mat\u00e9riels<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/developpement-de-formations-au-reglage-et-a-la-bonne-utilisation-des-materiels\/"},{"target_name":"Ravageurs","production_name":"Carotte","background_color":"#098aa9","number":"62","title":"<p><strong>Solution exp\u00e9rimentale\u00a0: Lutte contre le n\u00e9matode <em>Heterodera carotae <\/em>par une vari\u00e9t\u00e9 de carotte r\u00e9sistante.<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/solution-experimentale-lutte-contre-le-nematode-heterodera-carotae-par-une-variete-de-carotte-resistante\/"},{"target_name":"Ravageurs","production_name":"Arboriculture","background_color":"#59c6c8","number":"25","title":"<p>Utilisation de la confusion sexuelle en verger de pommier, poirier, prunier, p\u00eacher, abricotier, noyer et ch\u00e2taignier<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-de-la-confusion-sexuelle-en-verger-de-pommier-poirier-prunier-pecher-abricotier-noyer-et-chataignier\/"},{"target_name":"Ravageurs","production_name":"Cultures l\u00e9gumi\u00e8res sous abri","background_color":"#098aa9","number":"28","title":"<p>Utilisation d\u2019insecticides de contact \u00e0 base de maltodextrine en cultures l\u00e9gumi\u00e8res sous abri<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-dinsecticides-de-contact-a-base-de-maltodextrine-en-cultures-legumieres-sous-abri\/"},{"target_name":"Maladies","production_name":"Bl\u00e9 tendre","background_color":"#54ccdc","number":"29","title":"<p>Lutte contre la septoriose avec des sp\u00e9cialit\u00e9s \u00e0 base de soufre<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-la-septoriose-avec-des-specialites-a-base-de-soufre\/"},{"target_name":"Maladies","production_name":"Vigne","background_color":"#129a8a","number":"66","title":"<p>Lutte contre le botrytis de la vigne avec des solutions de biocontr\u00f4le<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/lutte-contre-le-botrytis-de-la-vigne-avec-des-solutions-de-biocontrole\/"},{"target_name":"Ravageurs","production_name":"Toutes cultures","background_color":"#13696d","number":"63","title":"<p><strong>Evaluation du risque limaces, aide \u00e0 la d\u00e9cision<\/strong><\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/evaluation-du-risque-limaces-aide-a-la-decision\/"},{"target_name":"Maladies","production_name":"Betterave","background_color":"#098aa9","number":"8","title":"<p>Utilisation de vari\u00e9t\u00e9s tol\u00e9rantes aux maladies foliaires de la betterave sucri\u00e8re<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/utilisation-de-varietes-tolerantes-aux-maladies-foliaires-de-la-betterave-sucriere\/"},{"target_name":"Ravageurs","production_name":"Mangue","background_color":"#59C6C8","number":"49","title":"<p>Gestion de la mouche des fruits\u00a0en production de mangues\u00a0(Combinaison de m\u00e9thodes de biocontr\u00f4le)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/gestion-de-la-mouche-des-fruits-en-production-de-mangues-combinaison-de-methodes-de-biocontrole\/"},{"target_name":"Toutes cibles","production_name":"Toutes cultures","background_color":"#13696d","number":"31","title":"<p>Am\u00e9liorer le profil toxicologique des substances actives (DJA)<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/ameliorer-le-profil-toxicologique-des-substances-actives-dja\/"},{"target_name":"Ravageurs","production_name":"Ma\u00efs","background_color":"#098aa9","number":"23","title":"<p>Trichogrammes contre la pyrale du ma\u00efs<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/trichogrammes-contre-la-pyrale-du-mais\/"},{"target_name":"Maladies","production_name":"Pomme de Terre","background_color":"#54ccdc","number":"5","title":"<p>R\u00e9sistance vari\u00e9tale des pommes de terre vis-\u00e0-vis du mildiou<\/p>\n","link":"https:\/\/contratsolutions.fr\/le-contrat-de-solutions\/resistance-varietale-des-pommes-de-terre-vis-a-vis-du-mildiou\/"}]');

/*
    $GLOBALS['links'] is an array of pratiques, wich are constructed as such:

    [68] => stdClass Object
        (
            [target_name] => Maladies
            [production_name] => Pomme de Terre
            [background_color] => #54ccdc
            [number] => 5
            [title] => <p>Résistance variétale des pommes de terre vis-à-vis du mildiou</p>

            [link] => https://contratsolutions.fr/le-contrat-de-solutions/resistance-varietale-des-pommes-de-terre-vis-a-vis-du-mildiou/
        )
*/



include_once(__DIR__ . '/../includes/wikibuilder.php');

set_time_limit(0);
libxml_use_internal_errors(true);

if (!is_dir(__DIR__ . "/../out"))
    mkdir(__DIR__ . "/../out");

$filename = __DIR__ . "/../out/wiki_practices_cs.xml";

if (file_exists($filename))
    unlink($filename);

$GLOBALS['wikiBuilder'] = new wikiImportFile($filename);


initRelations();

importCSToWiki();

$GLOBALS['wikiBuilder']->close();
print_r($GLOBALS['unmanaged_tags']);

//------

function importCSToWiki()
{
	foreach ($GLOBALS['links'] as $pratique)
	{
		$filename = __DIR__ . '/fiches/' . $pratique->number . '.html';

		// Download each link in the temp directory as cache
		if (!file_exists($filename))
			copy($pratique->link, $filename);

		// Now detect the list of concepts, etc...
		// <div class="type-concept-title"> <i class="typeConcept-culture-20"></i> CULTURE </div>
		$doc = new DOMDocument();
		$doc->loadHTMLFile($filename);

		$date = "";
		$title = "";
		$conceptType = '';

		$xpath = new DOMXpath($doc);
		addPage($pratique, $xpath);
	}
}

function addPage($pratique, $xpath)
{
	echo "Extracting page: $pageName\n";

	$page = $GLOBALS['wikiBuilder']->addPage(strip_tags($pratique->title));

	// Add the content
	$elements = $xpath->query("//div[starts-with(@class, 'contenu-concept')]");
	foreach ($elements as $contentDiv)
	{
		foreach ($contentDiv->childNodes as $node)
		{
			$nodeName = strtolower($node->nodeName);

			if ($nodeName == '#text')
				continue;

			$class = $node->getAttribute('class');
			$id = $node->getAttribute('id');

			if ($id == 'titreContributeurs')
				break;

			switch ($class)
			{
				case 'depiction-concept-structure': // image node
					break;
				case 'sommaire-concept-structure': // sommaire
					break;

				default:
					$page->addContent(getWikiText($node)); break;
					break;
			}
		}

		break;
	}

	$page->addCategory($conceptType);

	// Add the categories
	addCategoriesForPage($page, $xpath);

	$page->close();
}

function addCategoriesForPage($page, $xpath)
{
	$elements = $xpath->query("//div[@class='type-concept-title']/i");
	foreach ($elements as $i)
	{
		$conceptType = $i->getAttribute('class');
		$conceptType = str_replace('typeConcept-', '', $conceptType);
		$conceptType = str_replace('-20', '', $conceptType);
		break;
	}

	if (empty($conceptType))
		return;

	$elements = $xpath->query("//div[@class='span2 liens-cell']");

	foreach ($elements as $div)
	{
		$rel = trim($div->textContent);
		$revrel = '';

		if (isset($GLOBALS['rel_labels'][$rel]))
			$rel = $GLOBALS['rel_labels'][$rel];
		else if (isset($GLOBALS['reverse_labels'][$rel]))
			$revrel = $GLOBALS['reverse_labels'][$rel];
		else
		{
			echo "relation not found\n";
			continue;
		}

		// Now go up one level, and find all relationships
		$containerDiv = $div->parentNode;
		$relationLinks = $xpath->query("div/div/div/div/div[contains(@class, 'lien-model-semantique')]/a", $containerDiv );
		// <div class="lien-model-semantique">
		//   <a href="/web/guest/concept/-/concept/voir/http%253A%252F%252Fwww%252Egeco%252Eecophytopic%252Efr%252Fgeco%252FConcept%252FGerer_Les_Populations_Des_Bioagresseurs_Grace_Aux_Mesures_Prophylactiques">Gérer les populations des bioagresseurs grâce aux mesures prophylactiques</a>
		// </div>
		//
		foreach ($relationLinks as $l)
		{
			$relurl = getFullUrl($l->getAttribute('href'));

			if (isset($GLOBALS['links'][$relurl]))
			{
				switch ($rel)
				{
					// Voir aussi
					case 'aPourFils':
					case 'aideAAppliquer':
					case 'estComplementaire':
					case 'estDefavorisePar':
					case 'estEvoqueDans':
					case 'estFavorisePar':
					case 'estImpactePar':
					case 'estIncompatible':
					case 'estInfluencePar':
					case 'evoque':
					case 'caracterise':
					case 'sAppuieSur':
					case 'utilisePour':
					case 'estUtilisePour':
						$page->addContent("Voir aussi : [[".$GLOBALS['links'][$relurl]."]]\n\n"); break;

					// Categories
					case 'aPourParent':
					case 'contribueA':
					case 'defavorise':
					case 'estAppliqueA':
					case 'estAssurePar':
					case 'estAttaquePar':
					case 'estMobiliseDans':
					case 'estRegulePar':
					case 'estRenseignePar':
					case 'estUtiliseDans':
					case 'favorise':
					case 'impacte':
					case 'influence':
					case 'informeSur':
					case 'regule':
					case 'sAppliqueA':
					case 'sAttaque':
					case 'utiliseDans':
						$page->addCategory($GLOBALS['links'][$relurl]);
						break;

					default:
						break;
				}
			}
			else
				echo "URL not found : $relurl \t" . $l->getAttribute('href') . "\t" . getCanonicalURL($relurl) . "\n";

		}

	}
}

function getCanonicalURL($url)
{
	// Start from http://geco.ecophytopic.fr/web/guest/concept/-/concept/voir/http%253A%252F%252Fwww%252Egeco%252Eecophytopic%252Efr%252Fgeco%252FConcept%252FPratiquer_L_Enherbement_Total_En_Vigne

	// First remove the http://geco.ecophytopic.fr/web/guest/concept/-/concept/voir/ part
	$url = str_replace('http://geco.ecophytopic.fr/web/guest/concept/-/concept/voir/', '', $url);
	$url = urldecode(urldecode($url));

	return $url;
}

function sanitizeFilename($str = '')
{
    $str = strip_tags($str);
    $str = preg_replace('/[\r\n\t ]+/', ' ', $str);
    $str = preg_replace('/[\"\*\/\:\<\>\?\'\|]+/', ' ', $str);
    $str = strtolower($str);
    $str = html_entity_decode( $str, ENT_QUOTES, "utf-8" );
    $str = htmlentities($str, ENT_QUOTES, "utf-8");
    $str = preg_replace("/(&)([a-z])([a-z]+;)/i", '$2', $str);
    $str = str_replace(' ', '-', $str);
    $str = rawurlencode($str);
    $str = str_replace('%', '-', $str);
    return $str;
}

function initRelations()
{
	$GLOBALS['relations'] = array();
	$GLOBALS['relations']['defavorise'] = array('rel' => 'defavorise', 'label' => 'défavorise', 'reverse' => 'estDefavorisePar', 'reverse_label' => 'est défavorisé par');
	$GLOBALS['relations']['estAppliqueA'] = array('rel' => 'estAppliqueA', 'label' => 'est appliqué à', 'reverse' => 'estMobiliseDans', 'reverse_label' => 'est mobilisé dans');
	$GLOBALS['relations']['estComplementaire'] = array('rel' => 'estComplementaire', 'label' => 'est complémentaire', 'reverse' => 'estComplementaire', 'reverse_label' => '');
	$GLOBALS['relations']['estIncompatible'] = array('rel' => 'estIncompatible', 'label' => 'est incompatible', 'reverse' => 'estIncompatible', 'reverse_label' => '');
	$GLOBALS['relations']['estUtilisePour'] = array('rel' => 'estUtilisePour', 'label' => 'est utilisé pour', 'reverse' => 'utilisePour', 'reverse_label' => '');
	$GLOBALS['relations']['favorise'] = array('rel' => 'favorise', 'label' => 'favorise', 'reverse' => 'estFavorisePar', 'reverse_label' => 'est favorisé par');
	$GLOBALS['relations']['impacte'] = array('rel' => 'impacte', 'label' => 'impacte', 'reverse' => 'estImpactePar', 'reverse_label' => 'est impacté par');
	$GLOBALS['relations']['influence'] = array('rel' => 'influence', 'label' => 'influence', 'reverse' => 'estInfluencePar', 'reverse_label' => 'est influencé par');
	$GLOBALS['relations']['informeSur'] = array('rel' => 'informeSur', 'label' => 'informe sur', 'reverse' => 'estRenseignePar', 'reverse_label' => 'est renseigné par');
	$GLOBALS['relations']['regule'] = array('rel' => 'regule', 'label' => 'régule', 'reverse' => 'estRegulePar', 'reverse_label' => 'est régulé par');
	$GLOBALS['relations']['sAttaque'] = array('rel' => 'sAttaque', 'label' => "s'attaque à", 'reverse' => 'estAttaquePar', 'reverse_label' => 'est attaqué par');
	$GLOBALS['relations']['utiliseDans'] = array('rel' => 'utiliseDans', 'label' => 'utilise', 'reverse' => 'estUtiliseDans', 'reverse_label' => 'est utilisé dans');
	$GLOBALS['relations']['aPourFils'] = array('rel' => 'aPourFils', 'label' => 'a pour fils', 'reverse' => 'aPourParent', 'reverse_label' => 'a pour parent');
	$GLOBALS['relations']['caracterise'] = array('rel' => 'caracterise', 'label' => 'caractérise', 'reverse' => 'sAppliqueA', 'reverse_label' => "s'applique à");
	$GLOBALS['relations']['contribueA'] = array('rel' => 'contribueA', 'label' => 'contribue à', 'reverse' => 'estAssurePar', 'reverse_label' => 'est assuré par');
	$GLOBALS['relations']['evoque'] = array('rel' => 'evoque', 'label' => 'évoque', 'reverse' => 'estEvoqueDans', 'reverse_label' => 'est évoqué dans');
	$GLOBALS['relations']['sAppuieSur'] = array('rel' => 'sAppuieSur', 'label' => "s'appuie sur", 'reverse' => 'aideAAppliquer', 'reverse_label' => 'aide à appliquer');

	$GLOBALS['rel_labels'] = array();
	$GLOBALS['reverse_labels'] = array();
	foreach ($GLOBALS['relations'] as $k => $v)
	{
		$GLOBALS['reverse_labels'][$v['reverse_label']] = $k;
		$GLOBALS['rel_labels'][$v['label']] = $k;
	}
}

function getWikiText($node, $context = '', $bNewParagraph = true)
{
	if (is_a($node, 'DOMNodeList'))
	{
		$text = '';
		foreach ($node as $childnode)
		{
			$text .= getWikiText($childnode, $context, $bNewParagraph);
			if ($bNewParagraph != 'always')
				$bNewParagraph = false;
		}

		return $text;
	}

	switch ($node->nodeName)
	{
		case '#text':
		case '#cdata-section':
			if ($bNewParagraph)
				return ltrim($node->textContent);
			else
				return $node->textContent;

		case 'li':
			if ($context == 'ol')
				return "# " .trim(getWikiText($node->childNodes)). "\n";
			else
				return "* " .trim(getWikiText($node->childNodes)) . "\n";

		case 'h1': return "\n=" .getWikiText($node->childNodes) . "=\n";
		case 'h2': return "\n==" .getWikiText($node->childNodes) . "==\n";
		case 'h3': return "\n===" .getWikiText($node->childNodes) . "===\n";

		case 'b':
		case 'strong':
			return "'''" .getWikiText($node->childNodes) . "'''";

		case 'br':
			return "\n\n";

		case 'script':
		case 'style':
			return "";

		case 'ol':
		case 'ul':
			return "\n" . getWikiText($node->childNodes, $node->nodeName, 'always');

		case 'p':
		case 'div':
			return "\n\n" . getWikiText($node->childNodes);

		case 'a':
			$url = getFullUrl($node->getAttribute('href'));

			if (isset($GLOBALS['links'][$url]))
				return "[[".$GLOBALS['links'][$url]."|". getWikiText($node->childNodes)."]]";
			else
				return "[$url ". getWikiText($node->childNodes)."]";

		default:
			if (!isset($GLOBALS['unmanaged_tags'][$node->nodeName]))
				$GLOBALS['unmanaged_tags'][$node->nodeName] = 1;
			else
				$GLOBALS['unmanaged_tags'][$node->nodeName] ++;

			return getWikiText($node->childNodes);
	}


	return '';
}

function getFullUrl($url)
{
	$url = str_replace('http://geco.ecophytopic.fr/web/guest', '', $url);
	$url = str_replace('http://geco.ecophytopic.fr', '', $url);

	if (strpos($url, '/concept/-/concept') === 0)
		return 'http://geco.ecophytopic.fr/web/guest' . $url;
	else if (strpos($url, '/web/guest') === 0)
		return 'http://geco.ecophytopic.fr' . $url;
	else if (strpos($url, '/') === 0)
		return 'http://geco.ecophytopic.fr' . $url;

	return $url;
}